<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatify</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<h1 class="head">Chatify</h1>

<div class="header-row">
    <p class="subhead">All Messages</p>
    <form action="/chats/new" method="get">
        <button class="newbtn">New Chat</button>
    </form>
</div>

<div id="chatBox">
    <% chats.forEach(chat => { %>
        <div class="container">
            <p>Sent from : <i><%= chat.from %></i></p>

            <div class="msg">
                <p><%= chat.message %></p>
            </div>

            <p>Received to : <i><%= chat.to %></i></p>

            <p>
                Time&Date :
                <%= chat.timestamp.toLocaleString() %>
            </p>

            <form action="/chats/<%= chat._id %>/edit" method="get">
                <button class="editbtn">Edit</button>
            </form>

            <form action="/chats/<%= chat._id %>?_method=DELETE" method="POST"
                  onsubmit="return confirm('Delete this chat?');">
                <button class="delbtn">Delete</button>
            </form>
        </div>
    <% }) %>
</div>

<!-- SOCKET.IO -->
<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const chatBox = document.getElementById("chatBox");

    socket.on("receive-message", (chat) => {
        const div = document.createElement("div");
        div.classList.add("container");

        div.innerHTML = `
            <p>Sent from : <i>${chat.from}</i></p>
            <div class="msg"><p>${chat.message}</p></div>
            <p>Received to : <i>${chat.to}</i></p>
            <p>Time&Date : ${new Date(chat.timestamp).toLocaleString()}</p>
        `;

        chatBox.appendChild(div);
    });
</script>

</body>
</html>
